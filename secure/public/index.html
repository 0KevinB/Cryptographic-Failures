<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úì VERSI√ìN SEGURA - Cryptographic Failures Demo</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header secure">
            <div class="secure-banner">
                <span class="secure-icon">üîí</span>
                <h1>VERSI√ìN SEGURA</h1>
                <span class="secure-icon">‚úì</span>
            </div>
            <p class="subtitle">A04:2025 - Implementaci√≥n Segura contra Cryptographic Failures</p>
            <div class="protections-list">
                <h3>Protecciones Implementadas:</h3>
                <ul>
                    <li>‚úì Contrase√±as con bcrypt (12 rounds)</li>
                    <li>‚úì Datos sensibles cifrados (AES-256-GCM)</li>
                    <li>‚úì Rate limiting activo</li>
                    <li>‚úì Tokens criptogr√°ficamente seguros</li>
                    <li>‚úì Cookies con flags de seguridad</li>
                    <li>‚úì Headers de seguridad (Helmet)</li>
                    <li>‚úì Validaci√≥n de contrase√±as fuertes</li>
                    <li>‚úì Enmascaramiento de datos sensibles</li>
                    <li>‚úì Auditor√≠a de accesos</li>
                </ul>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Session Info -->
            <div id="sessionInfo" class="session-info hidden">
                <h3>üîí Sesi√≥n Activa</h3>
                <p><strong>Usuario:</strong> <span id="currentUser"></span></p>
                <p><strong>Token:</strong> <span id="currentToken" class="token">‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè</span></p>
                <small>Token criptogr√°ficamente seguro (no mostrado por seguridad)</small>
                <button onclick="logout()" class="btn btn-secondary">Cerrar Sesi√≥n</button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('register', event)">Registro</button>
                <button class="tab-button" onclick="showTab('login', event)">Login</button>
                <button class="tab-button" onclick="showTab('profile', event)">Perfil</button>
                <button class="tab-button" onclick="showTab('sensitive', event)">Datos Sensibles</button>
                <button class="tab-button" onclick="showTab('users', event)">Usuarios</button>
            </div>

            <!-- Register Tab -->
            <div id="registerTab" class="tab-content active">
                <h2>Registro de Usuario</h2>
                <form onsubmit="register(event)">
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="regUsername" required minlength="3">
                        <small class="hint">M√≠nimo 3 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="regPassword" required>
                        <small class="hint secure-hint">‚úì Requisitos: Min 12 caracteres, may√∫sculas, min√∫sculas, n√∫meros y caracteres especiales (!@#$%^&*)</small>
                        <div id="passwordStrength" class="password-strength"></div>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label>SSN (N√∫mero de Seguro Social):</label>
                        <input type="text" id="regSSN" placeholder="XXX-XX-XXXX" pattern="\d{3}-\d{2}-\d{4}">
                        <small class="hint secure-hint">‚úì Se cifrar√° con AES-256-GCM antes de almacenar</small>
                    </div>
                    <div class="form-group">
                        <label>Tarjeta de Cr√©dito:</label>
                        <input type="text" id="regCard" placeholder="4532123456789010 o 4532-1234-5678-9010">
                        <small class="hint secure-hint">‚úì Se cifrar√° con AES-256-GCM antes de almacenar</small>
                    </div>
                    <div class="form-group">
                        <label>Informaci√≥n M√©dica:</label>
                        <textarea id="regMedical" rows="3"></textarea>
                        <small class="hint secure-hint">‚úì Se cifrar√° con AES-256-GCM antes de almacenar</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar</button>
                </form>
            </div>

            <!-- Login Tab -->
            <div id="loginTab" class="tab-content">
                <h2>Iniciar Sesi√≥n</h2>
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="loginUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Iniciar Sesi√≥n</button>
                </form>
                <div class="info-box secure">
                    <h4>üîí Protecciones de Login</h4>
                    <ul>
                        <li><strong>Rate Limiting:</strong> M√°ximo 5 intentos cada 15 minutos</li>
                        <li><strong>Bloqueo de cuenta:</strong> Cuenta bloqueada 15 minutos tras 5 intentos fallidos</li>
                        <li><strong>Verificaci√≥n segura:</strong> Usando bcrypt para comparar contrase√±as</li>
                        <li><strong>Auditor√≠a:</strong> Todos los intentos se registran</li>
                    </ul>
                </div>
                <div id="rateLimitInfo" class="info-box warning hidden">
                    <h4>‚ö†Ô∏è Rate Limit Activado</h4>
                    <p id="rateLimitMessage"></p>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content">
                <h2>Mi Perfil</h2>
                <button onclick="getProfile()" class="btn btn-primary">Obtener Perfil</button>
                <div id="profileResult" class="result-box"></div>
                <div class="info-box secure">
                    <h4>üîí Protecci√≥n de Datos</h4>
                    <p>Los datos sensibles se muestran <strong>enmascarados</strong> por defecto.</p>
                    <p>Solo se muestran los √∫ltimos 4 d√≠gitos de SSN y tarjeta de cr√©dito.</p>
                    <p>Para ver los datos completos, usa la pesta√±a "Datos Sensibles" y reaut√©nticate.</p>
                </div>
            </div>

            <!-- Sensitive Data Tab -->
            <div id="sensitiveTab" class="tab-content">
                <h2>üîê Acceso a Datos Sensibles Completos</h2>
                <div class="info-box warning">
                    <h4>‚ö†Ô∏è Reautenticaci√≥n Requerida</h4>
                    <p>Para acceder a tus datos sensibles completos, debes confirmar tu identidad ingresando tu contrase√±a.</p>
                    <p>Este acceso quedar√° registrado en el log de auditor√≠a.</p>
                </div>
                <form onsubmit="getSensitiveData(event)">
                    <div class="form-group">
                        <label>Confirma tu contrase√±a:</label>
                        <input type="password" id="sensitivePassword" required>
                    </div>
                    <button type="submit" class="btn btn-warning">Acceder a Datos Completos</button>
                </form>
                <div id="sensitiveResult" class="result-box"></div>
            </div>

            <!-- Users Tab -->
            <div id="usersTab" class="tab-content">
                <h2>Lista de Usuarios</h2>
                <button onclick="getUsers()" class="btn btn-primary">Obtener Usuarios</button>
                <div id="usersResult" class="result-box"></div>
                <div class="info-box secure">
                    <h4>‚úì Protecci√≥n de Privacidad</h4>
                    <p>Este endpoint solo muestra informaci√≥n p√∫blica de los usuarios:</p>
                    <ul>
                        <li>ID</li>
                        <li>Username</li>
                        <li>Email</li>
                        <li>Fecha de creaci√≥n</li>
                    </ul>
                    <p><strong>NO se exponen:</strong> Contrase√±as, SSN, tarjetas de cr√©dito ni informaci√≥n m√©dica.</p>
                </div>
            </div>
        </main>

        <!-- Response Area -->
        <div id="responseArea" class="response-area hidden">
            <h3>√öltima Respuesta del Servidor</h3>
            <pre id="responseContent"></pre>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
